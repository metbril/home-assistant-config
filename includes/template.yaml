---
## MS Teams
- binary_sensor:
    - name: "Robert In Call"
      unique_id: aeed7e2e-2d9c-45d2-a2d1-2c9cfc54a5a0
      state: >-
        {{ states("input_text.teams_status_robert") in ["OnThePhone","Presenting"] }}
      icon: >-
        {{ "mdi:phone-in-talk" if is_state('binary_sensor.robert_in_call','on') else "mdi:phone-off" }}

## Tumble Dryer
#
# Appliance is on when power usage detected
- binary_sensor:
    - name: "Tumble Dryer Running"
      unique_id: e266f060-376f-4067-8b9d-c8a21e49f890
      state: "{{ states('sensor.tumble_dryer_power') | float(0) > 2.5 }}"
      delay_on:
        seconds: 30
      delay_off:
        seconds: 55
      icon: "mdi:tumble-dryer{{ '-off' if (this.state == 'off') }}"

- sensor:
    - name: Living TV Volume Level
      unique_id: 655f97da-54dc-40d2-8de1-db1b9cc66bf3
      unit_of_measurement: "%"
      availability: >-
        {{ state_attr('media_player.living_tv','volume_level') is not none }}
      state: >-
        {{ (state_attr('media_player.living_tv','volume_level')
          | float(0) * 100) | int }}
      icon: >-
        {% set state = states('sensor.living_tv_volume_level') | float(0) %}
        {% if state == 0.0 %} mdi:volume-off
        {% elif state <= 0.3 %} mdi:volume-low
        {% elif state <= 0.6 %} mdi:volume-medium
        {% else %} mdi:volume-high
        {% endif %}

# UV Protection Window
- binary_sensor:
    - name: UV Protection Window
      unique_id: "1fed4c80-a646-4133-961c-776da75f1624"
      device_class: safety
      availability: >-
        {{ states('binary_sensor.bescherming_venster') not in ['unknown', 'unavailable', None] }}
      state: >-
        {% set now = now() | as_timestamp | float(0) %}
        {% set lower = state_attr('binary_sensor.bescherming_venster','start_time') | as_timestamp | float(0) %}
        {% set upper = state_attr('binary_sensor.bescherming_venster','end_time') | as_timestamp | float(0) %}
        {{ (lower <= now <= upper) }}

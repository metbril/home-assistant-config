---
# Package: Occupancy

template:

  - sensor:
      - name: "Occupancy"
        unique_id: c84e912d-287c-4e51-8c41-30eebe8fece6
        state: >-
          {% set value = (states.input_boolean
            | select('search', 'occupancy_')
            | selectattr('state', 'eq', 'on')
            | map(attribute='entity_id') | list | first) %}
          {{ value.split('.')[1].split("_")[1] if value is defined else 'unknown' }}
        icon: >-
          {% set occupancy = states('sensor.occupancy') %}
          {% if occupancy is not in [None, 'unknown', 'unavailable'] %}
            {{ state_attr('input_boolean.occupancy_' + occupancy, 'icon') }}
          {% else %}
            mdi:home-off-outline
          {% endif %}

  - binary_sensor:
      - name: "Occupancy"
        unique_id: 80fb3594-f0d4-4ae4-8251-f31e1d9b301f
        state: >-
          {{ states.input_boolean | select('search', 'occupancy_')
              | selectattr('state', 'eq', 'on') | map(attribute='entity_id')
              | list | count != 0 }}
        icon: >-
          {{ state_attr('sensor.occupancy', 'icon') }}

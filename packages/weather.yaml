################################################
## Packages / Weather
################################################

homeassistant:
  customize:

    ################################################
    ## Node Anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: 'weather'

      expose: &expose
        <<: *customize
        haaska_hidden: false
        homebridge_hidden: false

    ################################################
    ## Sensor
    ################################################

    sensor.buienradar_precipitation_forecast_average:
      <<: *customize
      friendly_name: 'Verwachte gemiddelde neerslag'
      unit_of_measurement: 'mm/u'

    ################################################
    ## Automation
    ################################################

    automation.rain_alarm:
      <<: *customize
      friendly_name: 'Buienalarm'

################################################
## Sensor
################################################

sensor:
  - platform: darksky
    api_key: !secret darksky_api_key
    units: si
    monitored_conditions:
      - temperature
      - humidity
      - pressure
      - wind_speed
      - wind_bearing
      - ozone
      - uv_index
      - precip_intensity
      - precip_probability
      - summary
      - icon
  - platform: buienradar
    name: Buienradar
    latitude: !secret home_latitude
    longitude: !secret home_longitude
    timeframe: 30
    monitored_conditions:
      - precipitation_forecast_average

################################################
## Group
################################################

group:
  weather:
    name: Weerbericht
    entities:
      - sensor.dark_sky_summary
      - sensor.dark_sky_icon
      - sensor.dark_sky_temperature
      - sensor.dark_sky_apparent_temperature
      - sensor.dark_sky_dew_point
      - sensor.dark_sky_humidity
      - sensor.dark_sky_pressure
      - sensor.dark_sky_visibility
      - sensor.dark_sky_cloud_coverage
      - sensor.dark_sky_wind_speed
      - sensor.dark_sky_wind_bearing
      - sensor.dark_sky_precip_type
      - sensor.dark_sky_precip
      - sensor.dark_sky_precip_intensity
      - sensor.dark_sky_precip_probability

################################################
## Automation
################################################

automation:
  - alias: Rain Alarm
    trigger:
      - platform: numeric_state
        entity_id: sensor.buienradar_precipitation_forecast_average
        above: 0
    action:
      - service: notify.telegram
        data_template:
          title: "Regenalarm"
          message: "De komende 30 minuten wordt {{ trigger.to_state.state }} {{ trigger.to_state.attributes.unit_of_measurement }} neerslag verwacht"

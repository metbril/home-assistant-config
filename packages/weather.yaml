################################################
## Packages / Weather
################################################

homeassistant:
  customize:

    ################################################
    ## Node Anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: 'weather'

      expose: &expose
        <<: *customize
        haaska_hidden: false
        homebridge_hidden: false

    ################################################
    ## Sensor
    ################################################

    sensor.buienradar_precipitation_forecast_average:
      <<: *customize
      friendly_name: 'Verwachte gemiddelde neerslag'
      unit_of_measurement: 'mm/u'

    ################################################
    ## Automation
    ################################################

    automation.rain_alarm:
      <<: *customize
      friendly_name: 'Buienalarm'

################################################
## Sensor
################################################

sensor:
  - platform: darksky
    api_key: !secret darksky_api_key
    units: si
    monitored_conditions:
      - temperature
      - apparent_temperature
      - dew_point
      - humidity
      - pressure
      - visibility
      - cloud_cover
      - wind_speed
      - wind_bearing
      - ozone
      - precip_type
      - precip_intensity
      - precip_probability
      - summary
      - icon
  - platform: buienradar
    name: Buienradar
    latitude: !secret home_latitude
    longitude: !secret home_longitude
    timeframe: 30
    monitored_conditions:
      - precipitation_forecast_average

################################################
## Automation
################################################

automation:
  - alias: Rain Alarm
    trigger:
      - platform: state
        entity_id: sensor.buienradar_precipitation_forecast_average
    action:
      - service: notify.telegram
        data_template:
          title: "Regenalarm"
          message: "De komende 30 minuten wordt {{ trigger.to_state.state }} {{ trigger.to_state.attributes.unit_of_measurement }} neerslag verwacht"

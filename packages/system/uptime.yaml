---
##################################################
# Packages / System / Uptime
##################################################

sensor:

  - platform: uptime

# binary_sensor:
#
#   # https://home-assistant.io/components/sensor.command_line/
#   - platform: command_line
#     name: Last Restart
#     command: date "+%Y-%m-%dT%H:%M:%S%z" -d "$(head -n1 /config/home-assistant.log | cut -d' ' -f-2)"
#     value_template: '{{ value }}'
#
#   # https://home-assistant.io/components/sensor.command_line/
#   - platform: command_line
#     name: "HA Uptime"
#     command: echo "$(($(date +%s) - $(date -d "$(head -n1 /config/home-assistant.log | cut -d' ' -f-2)" +%s)))"
#     scan_interval: 60  # seconds
#     value_template: >-
#       {% set uptime = value | int %}
#       {% set seconds = uptime % 60 %}
#       {% set minutes = ((uptime % 3600) / 60) | int %}
#       {% set hours = ((uptime % 86400) / 3600) | int %}
#       {% set days = (uptime / 86400) | int %}
#       {% if days > 0 %}
#         {% if days == 1 %}
#           1 day
#         {% else %}
#           {{ days }} days
#         {% endif %}
#         {{ ', ' }}
#       {% endif %}
#       {{ '%02d' % hours }}:{{ '%02d' % minutes }}

automation:

  ##############################################################################
  - alias: Home Assistant Stop Tweet
    id: f1a564aa-c8da-4f88-bf61-b938627374b2

    trigger:
      - platform: homeassistant
        event: shutdown

    action:
      - service: notify.twitter
        data:
          message: >-
            {% set phrases = [
              "ðŸ’¤ Ik ga even een dutje doen.",
              "ðŸš¶ Ik moet even weg, maar ik ben zo weer terug.",
              "ðŸ™ˆ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, wie niet weg is, is gezien!",
              "â›” Home Assistant wordt gestopt."
            ] %}
            {% set hashtags = [
              "#HomeAutomation",
              "#SmartHome",
              "#Domotica",
              "#IoT"
            ] %}
            {{ phrases|random ~ " " ~ hashtags|random ~ " #HomeAssistant" ~
            " https://metbril.github.io/home-assistant-config"}}
          data:
            media: >-
              {% set pictures = [
                "/config/www/img/tweets/uptime/shutdown_laptop.jpg",
                "/config/www/img/tweets/uptime/tv_color_bars.png",
                "/config/www/img/tweets/uptime/tv_offline.jpg",
                "/config/www/img/tweets/uptime/tv_noise.jpg"
              ] %}
              {{ pictures|random }}

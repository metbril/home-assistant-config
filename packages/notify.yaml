################################################
## Packages / Notify
################################################

homeassistant:
  customize:
    ################################################
    ## Node Anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: 'notify'

################################################
## Notify
################################################

notify:
  - name: admin
    platform: pushover
    api_key: !secret pushover_api_key
    user_key: !secret pushover_user_key

  - name: all
    platform: group
    services:
      - service: admin
      - service: ios_phonsine
      - service: ios_patti

################################################
## Automation
################################################

automation:
  - alias: Forward Persistent Notifications
    initial_state: 'on'
    trigger:
      - platform: event
        event_type: call_service
        event_data:
          domain: persistent_notification
          service: create
    action:
      - service: notify.admin
        data_template:
          message: >-
            {% set message = trigger.event.data.service_data.message %}
            {% if 'login attempt' in message|lower %}
              {{ message }}: http://www.ip-tracker.org/locator/ip-lookup.php?ip={{ message.split('from ')[1] }}
            {% else %}
              {{ message }}
            {% endif %}

################################################
## Packages / Vacation
##
## Requires package Lighting
################################################

homeassistant:
  customize:
    ################################################
    ## Node Anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: 'vacation'

      expose: &expose
        <<: *customize
        haaska_hidden: false
        homebridge_hidden: false

    ################################################
    ## Input Boolean
    ################################################

    input_boolean.on_vacation:
      <<: *customize
      friendly_name: "Met vakantie"
      icon: mdi:hotel

    ################################################
    ## Group
    ################################################

    group.vacation:
      <<: *customize
      friendly_name: "Vakantie"
      icon: mdi:hotel

################################################
## Input Boolean
################################################

input_boolean:
  on_vacation:
    name: "On Vacation"
    initial: off

################################################
## Group
################################################

group:
  vacation:
    name: Vacation
    entities:
      - input_boolean.on_vacation

################################################
## Automation
################################################

automation:
  # schakel de verlichting uit tussen 23:00 en 23:30 als we op vakantie zijn
  - alias: Schakel verlichting uit als op vakantie
    trigger:
      - platform: time
        at: '23:00:00'
    condition:
      - condition: state
        entity_id: input_boolean.on_vacation
        state: 'on'
    action:
      # wacht tussen 0:0:0 en 0:29:59
      - delay: '{{ "0:" ~ ((range(0,29)|random)|int) ~ ":" ~ ((range(0,59)|random)|int) }}'
      - service: light.turn_off
        entity_id: group.dusk_living_lights
      - service: notify.telegram
        data_template:
          title: '**Vakantieschakeling**'
          message: 'Schermverlichting woonkamer automatisch uitgeschakeld.'
  - alias: Notify Vaction Enabled
    trigger:
      platform: time
        at: '9:00:00'
    condition:
      - condition: state
        entity_id: input_boolean.on_vacation
        state: 'on'
    action:
      - service: notify.telegram
        data_template:
          title: '**Vakantieschakeling**'
          message: 'Vakantiemodus nog ingeschakeld.'

# TODO: bark the dog when the doorbell rings
################################################
## Packages / Date and Time
################################################

homeassistant:
  customize:

    ################################################
    ## Node Anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: 'datetime'


################################################
## Sun
################################################

sun:

################################################
## Binary Sensor
################################################

binary_sensor:
  - platform: workday
    name: Workday
    country: NL
    workdays: [ mon, tue, wed, thu, fri ]
  - platform: tod
    name: Morning
    after: 06:00
    before: sunrise
  - platform: tod
    name: Daytime
    after: sunrise
    before: sunset
  - platform: tod
    name: Evening
    after: sunset
    before: '23:00'
  - platform: tod
    name: Night
    after: '23:00'
    before: '06:00'

################################################
## Sensor
################################################

sensor:
  - platform: time_date
    display_options:
      - 'date'
      - 'time'
  - platform: template
    sensors:
      time_of_day:
        value_template: >
          {% set now = as_timestamp(now()) %}
          {% set midnight_start = ((now // (24*3600)) * (24*3600)) %}
          {% set tomorrow_start = (midnight_start + (24*3600)) %}
          {% set morning_start  = (midnight_start + (6*3600)) %}
          {% set next_rising = as_timestamp(states.sun.sun.attributes.next_rising) %}
          {% set next_setting = as_timestamp(states.sun.sun.attributes.next_setting) %}
          {% set next_dusk = (next_setting - (30*60)) %}
          {% set night_start  = (midnight_start + (23*3600)) %}
          {% if (now >= morning_start) and (now < next_rising) and (next_rising < tomorrow_start)  %}
            ochtend
          {% elif (next_rising > tomorrow_start) and (now < next_dusk) and (next_dusk < tomorrow_start) %}
            dag
          {% elif (next_dusk > tomorrow_start) and (now < night_start) and (next_setting < tomorrow_start) %}
            scherming
          {% elif (next_setting > tomorrow_start) and (now < night_start) %}
            avond
          {% elif (now >= night_start) %}
            nacht
          {% else %}
            onbekend
          {% endif %}

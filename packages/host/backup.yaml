################################################
## @description : Backup package
## @author      : Robert van Bregt
################################################

homeassistant:
  customize:
    ################################################
    ## Node Anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: 'backup'

################################################
## Folder Watcher
## https://www.home-assistant.io/components/folder_watcher/
##
## Currently not yet working, error on startup
## Whitelisting '/backup' is not yet possible with hassio
## https://github.com/home-assistant/hassio-build/issues/129
###############################################

# folder_watcher:
#   - folder: /backup
#     patterns: '*.tar'

################################################
## Automation
################################################
automation:

  - alias: Daily Full Backup
    description: Full snapshot every day at 2:00
    trigger:
      platform: time
      at: '02:00:00'
    action:
      - service: hassio.snapshot_full
        data_template:
          name: Automatische dagelijkse volledige backup {{ now().strftime('%Y-%m-%d') }}
          # password: YOUR PASSWORD

  - alias: Daily Dropbox Sync
    description: Sync all snapshots to Dropbox every day at 3:00
    trigger:
      - platform: time
        at: '03:00:00'
    action:
      - service: hassio.addon_stdin
        data:
          addon: 7be23ff5_dropbox_sync
          input:
            command: upload

  ## Send notification for new hassio backup
  ## Not working, waiting for folder watcher, see above
  # - alias: New file alert
  #   trigger:
  #     platform: event
  #     event_type: folder_watcher
  #     event_data:
  #       event_type: created
  #   action:
  #     service: notify.admin
  #     data_template:
  #       title: New backup
  #       message: "Created {{ trigger.event.data.file }} in {{ trigger.event.data.folder }}"


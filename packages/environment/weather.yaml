###############################################################################
#   @author         :   Robert van Bregt
#   @date           :   2019-12-19
#   @package        :   Weather
#   @description    :   Get local weather conditions
###############################################################################

homeassistant:
  customize:

    ################################################
    ## Node Anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: 'weather'

    ################################################
    ## Weather
    ################################################

    weather.dark_sky:
      <<: *customize
      friendly_name: Thuis

    ################################################
    ## Sensor
    ################################################

    sensor.dark_sky_apparent_temperature:
      <<: *customize
      friendly_name: Gevoelstemperatuur omgeving
    sensor.dark_sky_humidity:
      <<: *customize
      friendly_name: Luchtvochtigheid omgeving
    sensor.dark_sky_precip_intensity:
      <<: *customize
      friendly_name: Neerslagintensiteit omgeving
      unit_of_measurement: mm/u
    sensor.dark_sky_precip_probability:
      <<: *customize
      friendly_name: Neerslagkans omgeving
    sensor.dark_sky_pressure:
      <<: *customize
      friendly_name: Luchtdruk omgeving
    sensor.dark_sky_temperature:
      <<: *customize
      friendly_name: Temperatuur omgeving

    sensor.dark_sky_uv_index:
      <<: *customize
      friendly_name: UV-index Dark Sky
    sensor.dark_sky_ozone:
      <<: *customize
      friendly_name: Ozon Dark Sky
      icon: mdi:vector-triangle
    sensor.dark_sky_cloud_coverage:
      <<: *customize
      friendly_name: Bewolking

    sensor.dark_sky_wind_bearing:
      <<: *customize
      friendly_name: Windrichting omgeving
    sensor.dark_sky_wind_speed:
      <<: *customize
      friendly_name: Windsnelheid omgeving

    sensor.buienradar_precipitation_forecast_average:
      <<: *customize
      friendly_name: Verwachte neerslag
      unit_of_measurement: mm/u
    sensor.buienradar_precipitation_forecast_total:
      <<: *customize
      friendly_name: Verwachte neerslag
      unit_of_measurement: mm

    ################################################
    ## Binary Sensor
    ################################################

    binary_sensor.car_wash:
      <<: *customize
      friendly_name: "Auto wassen"

    ################################################
    ## Camera
    ################################################

    camera.buienradar:
      <<: *customize

    ################################################
    ## Automation
    ################################################

    automation.rain_alarm:
      <<: *customize
      friendly_name: Buienalarm

################################################
## Weather
################################################

weather:
  - platform: darksky
    api_key: !secret darksky_api_key
    units: si
    mode: daily

################################################
## Sensor
################################################

sensor:
  - platform: darksky
    api_key: !secret darksky_api_key
    units: si
    language: nl
    scan_interval:
      minutes: 10                     # default 2 minutes
    monitored_conditions:
      - summary
      - minutely_summary
      - icon
      - temperature
      - apparent_temperature
      - humidity
      - pressure
      - visibility
      - wind_speed
      - wind_gust
      - wind_bearing
      - cloud_cover
      - ozone
      - uv_index
      - precip_intensity
      - precip_probability
      - precip_type
      - alerts

  - platform: buienradar
    name: Buienradar
    latitude: !secret home_latitude
    longitude: !secret home_longitude
    timeframe: 30                     # minutes to look ahead for precipitation
    monitored_conditions:
      - precipitation_forecast_average
      - precipitation_forecast_total

################################################
## Binary Sensor
################################################
binary_sensor:

  - platform: car_wash
    weather: weather.dark_sky
  
################################################
## Camera
################################################
camera:
  - platform: buienradar
    name: Buienradar
    dimension: 700                      # largest size

################################################
## Automation
################################################
automation:

  - alias: Rain Alarm
    trigger:
      - platform: numeric_state
        entity_id: sensor.buienradar_precipitation_forecast_average
        above: 0
    action:
      - service: notify.all
        data_template:
          title: "Regenalarm"
          message: "De komende 30 minuten wordt {{ trigger.to_state.state }} {{ trigger.to_state.attributes.unit_of_measurement }} neerslag verwacht"

################################################
## Packages / RFXTRX
################################################

homeassistant:
  customize:

    ################################################
    ## Node Anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: 'rfxtrx'

    ################################################
    ## Sensor
    ################################################

    sensor.pws_th_humidity:
      <<: *customize
      friendly_name: "Luchtvochtigheid"
      icon: mdi:water-percent

    sensor.pws_th_temperature:
      <<: *customize
      friendly_name: "Temperatuur"

    sensor.pws_wind_wind_direction:
      <<: *customize
      friendly_name: "Windrichting"
      icon: mdi:compass
      unit_of_measurement: "Ëš"

    sensor.pws_rain_rain_rate:
      <<: *customize
      friendly_name: "Neerslag"
      icon: mdi:weather-rainy
      unit_of_measurement: "mm/u"

    ################################################
    ## Switch
    ################################################

    switch.living_wallswitch_left:
      <<: *customize
      friendly_name: 'Linker wandschakelaar woonkamer'
      assumed_state: off

    switch.living_wallswitch_right:
      <<: *customize
      friendly_name: 'Rechter wandschakelaar woonkamer'
      assumed_state: off

    ################################################
    ## Group
    ################################################

    group.pws:
      <<: *customize
      friendly_name: 'Weerstation'

############################################################
## Switch
############################################################

switch:
  - platform: rfxtrx
    automatic_add: false
    devices:
      0b11001000bb136201010f60: # 0bb13621 kaku remote 1
        name: KAKU Remote 1
        fire_event: true # to catch 'group off' event
      0b11001000bb136202010f60: # 0bb13622 kaku remote 2
        name: KAKU Remote 2             
      0b11001000bb136203010f60: # 0bb13623 kaku remote 3
        name: KAKU Remote 3
      0b1100190099acb60b010f60: # kaku wandschakelaar links
        name: Living Wallswitch Left
        fire_event: true
      0b1100250099acb60c010f60: # kaku wandschakelaar rechts
        name: Living Wallswitch Right
        fire_event: true
      0a140f01000b5501010f60: # lighting5 it 2901.01 On
        name: Power Garage Door
      0b110005011afee601040f60: # beldrukker woonkamer
        name: Mess Call
        fire_event: true
      0b11001601131fb20c010f80: # beldrukker voordeur
        name: Frontdoor Bell
        fire_event: true

############################################################
## Sensor
############################################################

sensor:
  - platform: rfxtrx
    automatic_add: false
    devices:
      0a5207023f0e0074380159:
        name: PWS TH
        data_type:
          - Humidity
          - Temperature
      0b55030c800c0000000a9569:
        name: PWS Rain
        data_type:
          - Rain rate
      105604029716013b000b000c0027002059:
        name: PWS Wind
        data_type:
          - Wind direction

############################################################
## Light
############################################################

light:
  - platform: rfxtrx
    automatic_add: false
    devices:
      0b1100100f05e81202010f70: # KAKU APA3-1500R (2)
        name: Standing IKEA Vaster # light.standing_ikea_vaster

  - platform: group
    name: Living Lights
    entities:
      - light.hoge_kast
      - light.bank
      - light.standing_ikea_vaster
      - light.bollamp
      - light.tv_meubel
    
############################################################
## Binary Sensor
############################################################

binary_sensor:
  - platform: rfxtrx
    automatic_add: false
    devices:
      0b110010011600020a010f70: # kaku motion
        name: motion_garage
      0b1100090029fc0201010f60: # flamingo remote A
        name: Flamingo Remote Button A

############################################################
## Group
############################################################

group:
  pws:
    name: Personal Weather Station
    entities:
      - sensor.pws_th_temperature
      - sensor.pws_th_humidity
      - sensor.pws_rain_rain_rate
      - sensor.pws_wind_wind_direction

############################################################
## Automation
############################################################

automation:

  - alias: KAKU Remote Group Off
    trigger:
      - platform: event
        event_type: button_pressed
        event_data: 
          entity_id: switch.kaku_remote_1
          state: 'group off'
    action:
      # - service: light.turn_off
      #   entity_id: group.living_lights
      # - service: logbook.log
      #   data:
      #     name: Woonkamerverlichting
      #     message: uitgeschakeld

  - alias: Turn Off Living Devices
    trigger:
      - platform: event
        event_type: button_pressed
        event_data: 
          entity_id: switch.living_wallswitch_left
          state: 'off'
    action:
      - service: light.turn_off
        entity_id: group.living_lights
      - service: logbook.log
        data:
          name: Woonkamerverlichting
          message: uitgeschakeld
      - service: notify.admin
        data:
          message: 'Woonkamerverlichting uitgeschakeld.'

  - alias: Turn On Living Dusk Devices
    trigger:
      - platform: event
        event_type: button_pressed
        event_data: 
          entity_id: switch.living_wallswitch_left
          state: 'on'
    action:
      - service: light.turn_on
        entity_id: group.dusk_living_lights
      - service: logbook.log
        data:
          name: Schemerverlichting
          message: ingeschakeld
      - service: notify.admin
        data:
          message: 'Schemerverlichting ingeschakeld.'

  - id: '1525863990560'
    alias: Bij opstarten schakelaars aan
    trigger:
    - event: start
      platform: homeassistant
    condition: []
    action:
    - data:
        entity_id: switch.power_garage_door
      service: homeassistant.turn_on

################################################
## Packages RFXTRX
################################################

homeassistant:
  customize:

    ################################################
    ## Node Anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: 'rfxtrx'

    ################################################
    ## Binary Sensor
    ################################################

    binary_sensor.motion_garage:
      <<: *customize
      friendly_name: "Beweging garage"
      # icon: mdi:run-fast

    ################################################
    ## Sensor
    ################################################

    sensor.frontdoor_bell_presses:
      <<: *customize
      friendly_name: "Bel voorkeur gebruikt"

    ################################################
    ## Switch
    ################################################

    switch.frontdoor_bell:
      <<: *customize
      friendly_name: 'Bel voordeur'
      icon: mdi:bell-ring
      assumed_state: off

    switch.mess_call:
      <<: *customize
      friendly_name: 'Bel verzamelen'
      icon: mdi:bell-ring
      assumed_state: off

    switch.power_garage_door:
      <<: *customize
      friendly_name: "Spanning garagedeur"
      # icon: mdi:power-plug
      # assumed_state: off

    # ################################################
    # ## Switch
    # ################################################

    light.kaku_wall_switch_left:
      <<: *customize
      friendly_name: "Plafond eettafel"
      assumed_state: off

    light.kaku_wall_switch_right:
      <<: *customize
      friendly_name: "Plafond sofa"
      assumed_state: off

    light.living_desk:
      <<: *customize
      friendly_name: "Staande lamp bureau"
      assumed_state: off


    ################################################
    ## Group
    ################################################

    group.kaku_remote_living:
      <<: *customize
      friendly_name: 'KAKU Afstandsbediening Woonkamer'

rfxtrx:
  device: /dev/serial/by-id/usb-RFXCOM_RFXtrx433_A1XQFD94-if00-port0
  debug: no

############################################################
## Cover
############################################################

cover:
  - platform: rfxtrx
    automatic_add: false

############################################################
## Light
############################################################

light:
  - platform: rfxtrx
    automatic_add: false
    devices:
      0b1100200099acb60b010f70: # 099acb611 kaku wall left
        name: KAKU Wall Switch Left
      0b11002c0099acb60c000070: # 099acb612 kaku wall right
        name: KAKU Wall Switch Right
      0b1100100f05e81202010f70: # KAKU APA3-1500R (2)
        name: Living Desk

############################################################
## Binary Sensor
############################################################

binary_sensor:
  - platform: rfxtrx
    automatic_add: false
    devices:
      0b110010011600020a010f70: # kaku motion
        name: motion_garage
        device_class: motion

############################################################
## Sensor
############################################################

sensor:
  - platform: history_stats
    name: Frontdoor Bell Presses
    entity_id: switch.frontdoor_bell
    state: 'on'
    type: count
    end: '{{ now() }}'
    duration:
      hours: 24

############################################################
## Switch
############################################################

switch:
  - platform: rfxtrx
    automatic_add: false
    devices:
      0b11001000bb136201010f60: # 0bb13621 kaku remote 1
        name: KAKU Remote 1
        fire_event: true # to catch 'group off' event
      0b11001000bb136202010f60: # 0bb13622 kaku remote 2
        name: KAKU Remote 2
      0b11001000bb136203010f60: # 0bb13623 kaku remote 3
        name: KAKU Remote 3
      0a140f01000b5501010f60: # lighting5 it 2901.01 On
        name: Power Garage Door
      0b110005011afee601040f60: # beldrukker woonkamer
        name: Mess Call
        fire_event: true
      0b11001601131fb20c010f80: # beldrukker voordeur
        name: Frontdoor Bell
        fire_event: true
      # not paired yet
      # 0b1100100f05e8120a010f60:
      #  name: Diner Ceiling
      # not paired yet
      # 0b1100100f05e8120b010f60:
      #  name: Sofa Ceiling

############################################################
## Automation
############################################################

automation:
  - alias: Frontdoor Bell Pressed
    trigger:
      - platform: event
        event_type: button_pressed
        event_data:
          entity_id: switch.frontdoor_bell
    action:
      - service: switch.turn_off
        entity_id: switch.frontdoor_bell
      - service: notify.all
        data_template:
          title: 'Bel voordeur'
          message: 'Er is aangebeld {{ as_timestamp(now()) | timestamp_custom("op %d-%m om %H:%M", True) }}'

  - alias: Mess Call Pressed
    trigger:
      - platform: event
        event_type: button_pressed
        event_data:
          entity_id: switch.mess_call
    action:
      - service: switch.turn_off
        entity_id: switch.mess_call
      - service: notify.all
        data:
          title: 'Etenstijd'
          message: 'Etenstijd!'

  - alias: KAKU Remote Group Off
    trigger:
      - platform: event
        event_type: button_pressed
        event_data: 
          entity_id: switch.kaku_remote_1
          state: 'group off'
    action:
      - service: light.turn_off
        entity_id: group.living_lights
      - service: logbook.log
        data:
          name: Woonkamerverlichting
          message: uitgeschakeld

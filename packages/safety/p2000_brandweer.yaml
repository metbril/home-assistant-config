################################################################################
## P2000
## https://github.com/cyberjunky/home-assistant-p2000
################################################################################
homeassistant:
  customize:
    sensor.p2000_brandweer:
      friendly_name: Brandweer

sensor:
  - platform: p2000
    name: P2000 Brandweer
    regios: 17                      # rotterdam rijnmond
    disciplines: Brandweerdiensten  # brandweer
    radius: 1000                    # meter, default 5000; from home
    nolocation: False               # inlucde without location, default True
    scan_interval: 30               # seconden, default 30
    icon: mdi:fire-truck

automation:
  - alias: "Safety: P2000 Brandweer Melding"
    description: >
      Stuur een melding aan de ouders dat de brandweer dichtbij is en plaats
      een bericht op Twitter.
    id: 971fc035-f021-4015-a54b-8c6da9ddf200
    mode: single

    trigger:
      - platform: state
        entity_id: sensor.p2000_brandweer

    condition: "{{states('sensor.p2000_brandweer') != 'unknown'}}"

    action:
      - variables:
          address: "{{ states('sensor.p2000_brandweer') }}"
          lat: "{{ state_attr('sensor.p2000_brandweer', 'latitude')  }}"
          lon: "{{ state_attr('sensor.p2000_brandweer', 'longitude') }}"
          url: >-
            http://www.openstreetmap.org/?mlat={{ lat }}&mlon={{ lon }}&zoom=16

      - service: notify.parents
        data:
          title: ğŸš’ P2000 Brandweer
          message: "{{ address }}"
          data:
            url: '{{ url }}'

      - service: notify.twitter
        data:
          message: >-
            ğŸš’ De #brandweer is in de buurt. #P2000

            {{ address }} {{ url }}

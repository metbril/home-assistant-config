############################################################################
## Packages / Updates
############################################################################

homeassistant:
  customize:
    ########################################################################
    ## Node Anchors
    ########################################################################

    package.node_anchors:
      customize: &customize
        package: 'updates'

    ########################################################################
    ## Updater
    ########################################################################

    updater.updater:
      friendly_name: HA Update Beschikbaar
      icon: mdi:sync

    ########################################################################
    ## Binary Sensor
    ########################################################################

    binary_sensor.hassio_update_available:
      device_class: safety
      friendly_name: Update Beschikbaar voor HA

    ########################################################################
    ## Sensor
    ########################################################################

    sensor.hassio_version_installed:
      friendly_name: GeÃ¯nstalleerde versie Hassio
    sensor.hassio_version_stable:
      friendly_name: Stabiele versie Hassio
    sensor.hassio_version_beta:
      friendly_name: Beta versie Hassio

    ########################################################################
    ## Automation
    ########################################################################

    automation.hassio_update_available_notification:
      friendly_name: Hassio Update Beschikbaar Melding
    automation.ha_update_available_notification:
      friendly_name: HA Update Beschikbaar Melding

############################################################################
## Updater
## https://www.home-assistant.io/components/updater/
## https://www.home-assistant.io/docs/backend/updater/
############################################################################

updater:
  reporting: true # collect basic information about this instance and its environment
  include_used_components: true # report components to developers

############################################################################
## Binary Sensor
############################################################################

binary_sensor:
  - platform: template
    sensors:
      hassio_update_available:
        value_template: >-
          {{ states.sensor.hassio_version_stable.state != states.sensor.hassio_version_installed.state and
             states.sensor.hassio_version_stable.state != 'unavailable' }}

############################################################################
## Sensor
############################################################################

sensor:
  - platform: version
    source: local
    name: Hassio Version Installed

  - platform: version
    source: hassio
    image: raspberrypi3
    beta: false
    name: Hassio Version Stable

  - platform: version
    source: hassio
    image: raspberrypi3
    beta: true
    name: Hassio Version Beta

############################################################################
## Automation
############################################################################

automation:

  - alias: 'HA Update Available Notification'
    trigger:
      - platform: state
        entity_id: updater.updater
    action:
      - service: notify.admin
        data:
          message: 'Update voor Home Assistant beschikbaar.'

  - alias: 'Hassio Update Available Notification'
    trigger:
      - platform: state
        entity_id: binary_sensor.hassio_update_available
    action:
      - service: notify.admin
        data:
          message: 'Hassio versie {{ states.sensor.hassio_version_stable.state }} is nu beschikbaar.'
          title: Home Assistant Update

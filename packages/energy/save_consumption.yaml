---
# Entities used:
# - sensor.energy_consumption_tarif_1
# - sensor.energy_consumption_tarif_2
# - sensor.gas_consumption

##############################################################################
## This notifier is used by the log energy consumption automation.
##
## https://www.home-assistant.io/integrations/file
##############################################################################
notify:
  - name: save_energy_consumption
    platform: file
    filename: energy_consumption.csv
    timestamp: false

automation:

  - alias: Save Energy Consumption
    description: >
      Save energy consumption to file every hour, at the full hour.

    id: 934b4450-7816-4064-b906-3a3894d99345

    trigger:
      - platform: time_pattern
        hours: '*'
        minutes: '0'
        seconds: '0'

    action:
      - service: notify.save_energy_consumption
        data:
          message: >
            {{ now() }},
            {{ states('sensor.energy_consumption_tarif_1') }},
            {{ states('sensor.energy_consumption_tarif_2') }},
            {{ states('sensor.gas_consumption')}}

      - service: logbook.log
        data:
          name: Energieverbruik (tarief 1)
          message: opgeslagen
          entity_id: sensor.energy_consumption_tarif_1
          domain: sensor

      - service: logbook.log
        data:
          name: Energieverbruik (tarief 2)
          message: opgeslagen
          entity_id: sensor.energy_consumption_tarif_2
          domain: sensor

      - service: logbook.log
        data:
          name: Gasverbruik
          message: opgeslagen
          entity_id: sensor.gas_consumption
          domain: sensor

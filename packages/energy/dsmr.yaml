---
homeassistant:
  customize:
    sensor.daily_energy_consumption_tarif_1:
      friendly_name: Dagelijks energieverbruik  (tarief 1)
    sensor.daily_energy_consumption_tarif_2:
      friendly_name: Dagelijks energieverbruik  (tarief 2)
    sensor.daily_gas_consumption:
      friendly_name: Dagelijks gasverbruik
    sensor.monthly_energy_consumption_tarif_1:
      friendly_name: Maandelijks energieverbruik  (tarief 1)
    sensor.monthly_energy_consumption_tarif_2:
      friendly_name: Maandelijks energieverbruik  (tarief 2)

################################################################################
## DSMR
## https://www.home-assistant.io/integrations/dsmr
################################################################################
sensor:
  - platform: template
    sensors:
      friendly_power_tariff:  # vertaald in NL
        friendly_name: Power Tariff
        unique_id: friendly_power_tariff
        value_template: >-
          {% set value = states('sensor.power_tariff') %}
          {{ value | replace('low', 'Laag') | replace('normal', 'Normaal') }}

      daily_energy_consumption:
        friendly_name: Daily Energy Consumption
        unique_id: daily_energy_consumption
        unit_of_measurement: kWh
        value_template: >-
          {{ states('sensor.daily_energy_consumption_tarif_1')|float +
              states('sensor.daily_energy_consumption_tarif_2')|float }}

      monthly_energy_consumption:
        friendly_name: Monthly Energy Consumption
        unique_id: monthly_energy_consumption
        unit_of_measurement: kWh
        value_template: >-
          {{ states('sensor.monthly_energy_consumption_tarif_1')|float +
              states('sensor.monthly_energy_consumption_tarif_2')|float }}

  - platform: statistics
    name: Daily Gas Consumption Statistics
    entity_id: sensor.daily_gas_consumption
    sampling_size: 24  # last 60 values (e.g. 1 hour)

  - platform: statistics
    name: Gas Consumption Statistics
    entity_id: sensor.gas_consumption
    sampling_size: 24  # last 60 values (e.g. 1 hour)

  - platform: filter
    name: Daily Gas Consumption Moving Average
    entity_id: sensor.daily_gas_consumption
    filters:
      - filter: time_simple_moving_average
        window_size: "24:00:00"
        precision: 3


################################################################################
## Utility Meter
## https://www.home-assistant.io/components/utility_meter/
################################################################################
utility_meter:

  hourly_gas_consumption:
    source: sensor.gas_consumption
    cycle: hourly

  daily_energy_consumption_tarif_1:
    source: sensor.energy_consumption_tarif_1
    cycle: daily

  daily_energy_consumption_tarif_2:
    source: sensor.energy_consumption_tarif_2
    cycle: daily

  daily_gas_consumption:
    source: sensor.gas_consumption
    cycle: daily

  monthly_energy_consumption_tarif_1:
    source: sensor.energy_consumption_tarif_1
    cycle: monthly

  monthly_energy_consumption_tarif_2:
    source: sensor.energy_consumption_tarif_2
    cycle: monthly

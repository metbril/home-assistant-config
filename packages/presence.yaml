################################################
## Packages / Presence
################################################

homeassistant:
  customize:

    ################################################
    ## Node Anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: 'presence'

      expose: &expose
        <<: *customize
        haaska_hidden: false
        homebridge_hidden: false

    ################################################
    ## Group
    ################################################

    group.family:
      <<: *customize
      friendly_name: Familie
      icon: mdi:human-male-female
    group.person_robert:
      <<: *customize
      friendly_name: Robert
      icon: mdi:human-male
    group.person_monique:
      <<: *customize
      friendly_name: Monique
      icon: mdi:human-female
    group.person_bjorn:
      <<: *customize
      friendly_name: BjÃ¶rn
      icon: mdi:human-male

################################################
## MQTT
################################################

mqtt:
  # broker: core-mosquitto
  broker: !secret mqtt_cloudmqtt_broker
  port: !secret mqtt_cloudmqtt_port
  username: !secret mqtt_cloudmqtt_username
  password: !secret mqtt_cloudmqtt_password

################################################
## Device Tracker
################################################

# https://home-assistant.io/components/device_tracker/

device_tracker:
  - platform: asuswrt
    host: !secret asuswrt_host
    username: !secret asuswrt_username
    ssh_key: !secret asuswrt_ssh_key
    track_new_devices: yes
    consider_home: 180
    interval_seconds: 12
    new_device_defaults:
      track_new_devices: false
      hide_if_away: false
  - platform: owntracks

################################################
## Group
################################################

group:
  family:
    control: hidden
    entities:
      - group.person_robert
      - group.person_monique
      - group.person_bjorn
  person_robert:
    control: hidden
    entities:
      - device_tracker.robert_iphone
      - device_tracker.robert_5384d5485cff48a9afe7596b7cd92b5b
  person_monique:
    control: hidden
    entities:
      - device_tracker.monique_iphone
  person_bjorn:
    control: hidden
    entities:
      - device_tracker.bjorn_iphone

################################################
## Automation
################################################

automation:
  - alias: Family Home
    trigger:
      - platform: state
        entity_id: group.family
    action:
      - service: notify.pushover
        data_template:
          title: "Familie Thuis"
          message: >-
            {% if is_state('trigger.to_state', 'home') -%}
              Iemand van de familie komt thuis.
            {%- else -%}
              Niemand van de familie is meer thuis.
            {%- endif %}

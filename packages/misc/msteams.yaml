---
############################################################
## Microsoft Teams Status from my work laptop.
##
## https://github.com/EBOOZ/TeamsStatus
############################################################

############################################################
# These sensors get updated by the remote REST POST script
# Sensors are intended as helpers, not for the UI
############################################################
input_text:
  teams_status_robert:
    name: Microsoft Teams status Robert
    icon: mdi:microsoft-teams
  teams_activity_robert:
    name: Microsoft Teams activity Robert
    icon: mdi:microsoft-teams

############################################################
# Sensors that can be used in the UI.
############################################################
sensor:
  - platform: template
    sensors:
      teams_status_robert:
        friendly_name: "Microsoft Teams status Robert"
        value_template: "{{states('input_text.teams_status_robert')}}"
        icon_template: "{{state_attr('input_text.teams_status_robert',
          'icon')}}"
        unique_id: sensor.teams_status_robert

      teams_activity_robert:
        friendly_name: "Microsoft Teams activity Robert"
        value_template: "{{states('input_text.teams_activity_robert')}}"
        icon_template: "{{state_attr('input_text.teams_activity_robert',
          'icon')}}"
        unique_id: sensor.teams_activity_robert

  - platform: history_stats
    name: Microsoft Teams Call Time Today Robert
    entity_id: sensor.teams_activity_robert
    state: "In gesprek"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  - platform: history_stats
    name: Microsoft Teams Call Count Today Robert
    entity_id: sensor.teams_activity_robert
    state: "In gesprek"
    type: count
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  # How long has Teams been online on the laptop
  # Tracks any state other than Offline or Unknown
  - platform: history_stats
    name: Microsoft Teams Online Today Robert
    entity_id: sensor.teams_status_robert
    state:
      - Beschikbaar
      - Bezet
      - Niet storen
      - Afwezig
      - Zo terug
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

############################################################
binary_sensor:
  - platform: template
    sensors:
      ############################################################
      # Helper sensor, mainly for showing an icon in a Lovelace badge
      ############################################################
      teams_status_robert:
        friendly_name: "Microsoft Teams status Robert"
        value_template: >-
          {{   is_state('sensor.teams_status_robert', 'Beschikbaar')
            or is_state('sensor.teams_status_robert', 'Bezet')
            or is_state('sensor.teams_status_robert', 'Afwezig')
            or is_state('sensor.teams_status_robert', 'Zo terug')
            or is_state('sensor.teams_status_robert', 'Niet storen')
            or is_state('sensor.teams_status_robert', 'Offline') }}
        icon_template: >-
          {% if   is_state('sensor.teams_status_robert', 'Beschikbaar') %}
            mdi:account-check
          {% elif is_state('sensor.teams_status_robert', 'Bezet') %}
            mdi:account-off
          {% elif is_state('sensor.teams_status_robert', 'Afwezig') %}
            mdi:account-arrow-right
          {% elif is_state('sensor.teams_status_robert', 'Zo terug') %}
            mdi:account-clock
          {% elif is_state('sensor.teams_status_robert', 'Niet storen') %}
            mdi:account-cancel
          {% elif is_state('sensor.teams_status_robert', 'Offline') %}
            mdi:account-remove
          {% else %}
            mdi:account-question
          {% endif %}

############################################################
scene:
  - name: Werk Beschikbaar
    id: e9d03c5e-e877-4aec-a976-e2622e641813
    icon: hass:account-check
    entities:
      light.werkstatus:
        state: 'off'

  - name: Werk Niet Storen
    id: 7c19f66a-664e-42e8-9498-dc841c79a0e4
    icon: hass:account-cancel
    entities:
      light.werkstatus:
        brightness: 255
        rgb_color:
          - 255
          - 79
          - 70
        state: 'on'
      media_player.studeerkamer:
        state: paused

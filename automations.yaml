- id: dummy
  alias: Dummy
  trigger: []
  condition: []
  action: []
- id: hacs_1578603337940
  alias: Melden HACS Updates
  description: ''
  trigger:
  - entity_id: sensor.hacs
    platform: state
  condition:
  - condition: template
    value_template: '{{ states(trigger.entity_id) != "unknown"}}'
  - condition: template
    value_template: '{{ (states(trigger.entity_id) | float) != 0}}'
  action:
  - data_template:
      message: "{% for repo in state_attr(trigger.entity_id, 'repositories') %}\n\
        \  **{{ repo.display_name }}** _{{ repo[\"installed version\"] }}_ -> _{{\
        \ repo[\"available version\"] }}_\n{% endfor %}"
      title: Te verwerken updates in HACS
    service: persistent_notification.create
- id: hacs_1578603656941
  alias: Melden HACS Repository
  description: ''
  trigger:
  - event_data:
      action: registration
    event_type: hacs/repository
    platform: event
  condition:
  - condition: template
    value_template: '{{ trigger.event.data.repository is defined }}'
  action:
  - data_template:
      message: '{% set repo = trigger.event.data.repository %} {% set id = trigger.event.data.repository_id
        %} [{{ repo }}](/hacs/repository/{{ id }}) werd zojuist toegevoegd aan HACS.'
      title: Nieuwe repository in HACS
    service: persistent_notification.create
- id: signals_1578650308372
  alias: Synchroniseer Signaallamp Scene
  description: ''
  trigger:
  - event_data:
      domain: scene
      service: turn_on
    event_type: call_service
    platform: event
  condition: []
  action:
  - data:
      message: Scene called
    service: notify.admin
- id: signals_1578658533
  alias: Set Rain Alarm Scene
  description: Trigger rain alarm when rain expected on workdays between 6 and 9 am
  trigger:
  - above: '0'
    entity_id: sensor.buienradar_precipitation_forecast_average
    platform: numeric_state
  condition:
  - condition: state
    entity_id: binary_sensor.workday
    state: 'on'
  - after: 06:00:00
    before: 09:00:00
    condition: time
  action:
  - data:
      entity_id: input_select.signaallamp_scene
      option: Regenalarm
    service: input_select.select_option
- id: signals_1578658827
  alias: Remove Rain Alarm Signal
  description: Remove rain alarm at 9 or when no rain expected
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.buienradar_precipitation_forecast_average'')
      | float == 0 }}'
  - at: 09:00:00
    platform: time
  condition:
  - condition: state
    entity_id: input_select.signaallamp_scene
    state: Regenalarm
  action:
  - data:
      entity_id: input_select.signaallamp_scene
      option: Uit
    service: input_select.select_option
- id: signals_1578659184
  alias: Sync Signaallamp Scene with Light
  description: Set scene input when light switched off manually
  trigger:
  - entity_id: light.signaallamp
    platform: state
    to: 'off'
  action:
  - data:
      entity_id: input_select.signaallamp_scene
      option: Uit
    service: input_select.select_option
- id: signals_1578661126
  alias: Update Signaallamp
  description: Update Signaallamp light using selected scene
  trigger:
  - entity_id: input_select.signaallamp_scene
    platform: state
  condition:
  - condition: state
    entity_id: input_boolean.signaallamp_enabled
    state: 'on'
  action:
  - data_template:
      entity_id: '{{ (''scene.signaal_'' ~ trigger.to_state.state) | lower | replace(''
        '', ''_'' ) }}'
    service: scene.turn_on
- id: lighting_1578815661
  alias: Turn On Living Lights at Dusk
  trigger:
    - platform: sun
      event: sunset
      offset: "-00:30:00"
  action:
    - service: light.turn_on
      entity_id: light.living_dusk
- id: lighting_1578815662
  alias: Turn On Living Lights
  description: 'Turn On Living Lights from RFXTRX Wall Switch'
  trigger:
    - platform: event
      event_type: button_pressed
      event_data: 
        entity_id: switch.living_wallswitch_left
        state: 'on'
  action:
    - service: light.turn_on
      entity_id: light.living
- id: lighting_1578815663
  alias: Turn Off Living Lights
  description: 'Turn Off Living Lights from RFXTRX Wall Switch'
  trigger:
    - platform: event
      event_type: button_pressed
      event_data: 
        entity_id: switch.living_wallswitch_left
        state: 'off'
  action:
    - service: light.turn_off
      entity_id: light.living
- id: presence_1578816540
  alias: "Melden Familie Thuis"
  trigger:
    - platform: state
      entity_id: group.family
  action:
    - service: notify.admin
      data_template:
        message: >-
          {% set state = trigger.to_state.state %}
          {% if state == 'home' -%}
            Ik heb gemerkt dat er weer iemand thuis is.
          {%- elif state == 'not_home' -%}
            Ik zie dat er niemand meer thuis is.
          {%- else -%}
            Ik weet even niet of er iemand thuis is.            
          {%- endif %}
- id: presence_1578816550
  alias: "Melden Nieuw Apparaat Gedetecteerd"
  trigger:
    - platform: event
      event_type: device_tracker_new_device
  action:
    - service: persistent_notification.create
      data:
        message: "Nieuw apparaat herkend. Controleer bestand 'known_devices.yaml' voor details."
        title: "Nieuw apparaat"
- id: notify_1578816860
  alias: Forward Persistent Notifications OLD
  initial_state: 'off'
  trigger:
    - platform: event
      event_type: call_service
      event_data:
        domain: persistent_notification
        service: create
  action:
    - service: notify.admin
      data_template:
        message: >-
          {% set message = trigger.event.data.service_data.message %}
          {% if 'login attempt' in message|lower %}
            {{ message }}: http://www.ip-tracker.org/locator/ip-lookup.php?ip={{ message.split('from ')[1] }}
          {% else %}
            {{ message }}
          {% endif %}
- id: rdw_1578819664
  alias: Notify APK Date Expiration
  description: 'Notify 21 days before the APK date expires'
  trigger:
    - platform: template
      value_template: "{{ ((as_timestamp(strptime(states('sensor.niro_expdate'), '%Y-%m-%d')) / 86400) | int) == ((as_timestamp(strptime(states('sensor.date'), '%Y-%m-%d')) / 86400) | int) + 21 }} }}"
  action:
    - service: notify.admin
      data_template:
        title: '*Auto*'
        message: De APK keuring verloopt op {{ states('sensor.niro_expdate') }}. Plan een APK keuring bij de garage.

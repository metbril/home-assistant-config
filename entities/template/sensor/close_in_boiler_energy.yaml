---
# Template sensor to fix a bug in some Neo wall plugs.
# The applied constant is the equivalent of 0x7FFFFFFF.
# Device precision is 2 decimals.
# The original sensosr is renamed to "...raw_energy"
#
# https://community.home-assistant.io/t/energy-consumption-for-neo-coolcam-plug/219844/26?u=metbril
#
- sensor:
    - name: "Close-in Boiler Energy"
      unique_id: eb89a9e4-4fea-458a-b84c-1f82f24b63f1
      unit_of_measurement: kWh
      device_class: energy
      state_class: total_increasing
      state: >-
        {% set value = states('sensor.close_in_boiler_raw_energy') | float(0) %}
        {% set const = 21474836.47 %}
        {% if value < 0 %}
          {{ (value + const) | round(2) }}
        {% else %}
          {{ value }}
        {% endif %}

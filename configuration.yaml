homeassistant:
  # Name of the location where Home Assistant is running
  name: Start
  # Location required to calculate the time the sun rises and sets
  latitude: !secret home_lat
  longitude: !secret home_lon
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: !secret home_ele
  # metric for Metric, imperial for Imperial
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: Europe/Amsterdam

# Show links to resources in log and frontend
#introduction:

# Enables the frontend
frontend:

# Enables configuration UI
config:

http:
  # Uncomment this to add a password (recommended!)
  api_password: !secret http_password
  # Uncomment this if you are using SSL or running in Docker etc
  # base_url: example.duckdns.org:8123

# Checks for available updates
updater:

# Discover some devices automatically
discovery:

# Allows you to issue voice commands from the frontend in enabled browsers
conversation:

# Enables support for tracking state changes over time.
history:

# Determine what gets stored in the database
recorder: !include recorder.yaml

# View all events in a logbook
logbook:

# Track the sun
sun:

light:
  platform: hue
  host: !secret ip_hue

# Text to speech
tts:
  - platform: google
    language: 'nl'

sensor:
  - platform: time_date
    display_options:
      - 'date'
      - 'time'
  - platform: worldclock
    time_zone: Europe/Amsterdam
  - platform: moon
  - platform: dsmr
    port: /dev/ttyP1
    dsmr_version: 4
  - platform: systemmonitor
    resources:
      - type: memory_use_percent
      - type: processor_use
      - type: disk_use_percent
        arg: /
      - type: last_boot
      - type: since_last_boot
  - platform: command_line
    name: CPU Temperature
    command: "cat /sys/class/thermal/thermal_zone0/temp"
    unit_of_measurement: "Â°C"
    value_template: '{{ value | multiply(0.001) }}'
  - platform: speedtest
    monitored_conditions:
      - ping
      - download
      - upload
  - platform: darksky
    api_key: !secret darksky_apikey
    units: si
    monitored_conditions:
      - temperature
      - apparent_temperature
      - dew_point
      - humidity
      - pressure
      - visibility
      - cloud_cover
      - wind_speed
      - wind_bearing
      - ozone
      - precip_type
      - precip_intensity
      - precip_probability
      - summary
      - icon
      - nearest_storm_distance
  - platform: waqi
    token: !secret waqi_token
    locations:
      - rotterdam
    stations:
      - Rotterdam

binary_sensor:
  - platform: template
    sensors:
      cpu_high:
        value_template: '{{ states.sensor.cpu_use.state | float > 50 }}'
        friendly_name: 'CPU hoog'
  - platform: template
    sensors:
      cpu_hot:
        value_template: '{{ states.sensor.cpu_temperature.state | float > 60 }}'
        friendly_name: 'CPU heet'

notify:
  - name: pushover
    platform: pushover
    api_key: !secret pushover_apikey
    user_key: !secret pushover_userkey

# uses known_devices.yaml (ignored by git)
device_tracker:
  - platform: asuswrt
    host: !secret router_host
    username: !secret router_user
    password: !secret router_password
    track_new_devices: no
    consider_home: 180
    interval_seconds: 12

group:

  ### GROUPS ###

  now:
    name: Nu
    entities:
      - sensor.date
      - sensor.time
      - sun.sun
      - sensor.moon
  weather:
    name: Weerbericht
    entities:
      - sensor.dark_sky_summary
      - sensor.dark_sky_icon
      - sensor.waqi_rotterdam
      - sensor.dark_sky_temperature
      - sensor.dark_sky_apparent_temperature
      - sensor.dark_sky_dew_point
      - sensor.dark_sky_humidity
      - sensor.dark_sky_pressure
      - sensor.dark_sky_visibility
      - sensor.dark_sky_cloud_cover
      - sensor.dark_sky_wind_speed
      - sensor.dark_sky_wind_bearing
      - sensor.dark_sky_ozone
      - sensor.dark_sky_precip_type
      - sensor.dark_sky_precip_intensity
      - sensor.dark_sky_precip_probability
  meter_readings:
    # dsmr slimme meter
    name: Meterstanden
    entities:
      - sensor.power_consumption
      - sensor.power_consumption_low
      - sensor.power_consumption_normal
      - sensor.gas_consumption

  system:
    # Systeeminformatie
    name: Systeem
    entities:
      - sensor.cpu_use
      - sensor.ram_use
      - sensor.disk_use_
      - binary_sensor.cpu_high
      - binary_sensor.cpu_hot
      - updater.updater
  speedtest:
    name: Speedtest
    entities:
      - sensor.speedtest_download
      - sensor.speedtest_upload
      - sensor.speedtest_ping
  family:
    name: Familie
    entities:
      - device_tracker.robert_iphone
      - device_tracker.monique_iphone
      - device_tracker.bjorn_iphone
  automation:
    name: Automatisering
    entities:
      - automation.download_laag
      - automation.update_available_notification

  ### VIEWS ###

  view_system:
    name: Systeem
    view: yes
    entities:
      - group.system
      - group.speedtest
  view_automation:
    name: Automatisering
    view: yes
    entities:
      - group.automation
      - group.alert


# ALERT component

alert:
  cpu_high:
    name: Gebruik CPU is hoog
    entity_id: binary_sensor.cpu_high
    state: 'on'
    repeat: 15
    can_acknowledge: True
    skip_first: False
    notifiers:
      - pushover
  cpu_hot:
    name: Temperatuur CPU is hoog
    entity_id: binary_sensor.cpu_high
    state: 'on'
    repeat: 15
    can_acknowledge: True
    skip_first: False
    notifiers:
      - pushover

# AUTOMATION component

automation:
  - alias: Download laag
    trigger:
      platform: numeric_state
      entity_id: sensor.speedtest_download
      below: 30
    action:
      service: notify.pushover
      data:
        message: "Waarschuwing: speedtest download onder 30Mbit/s."
  - alias: 'Update Available Notification'
    trigger:
      platform: state
      entity_id: updater.updater
    action:
      service: notify.pushover
      data:
        message: 'Update voor Home Assistant beschikbaar.'

# Lightning notification
#
# Requires the Blitzortung integration custom component:
# https://github.com/mrk-its/homeassistant-blitzortung
#
# Inspired by:
# https://github.com/mrk-its/homeassistant-blitzortung
# https://www.vcloudinfo.com/2020/08/adding-a-lightning-sensor-to-home-assistant.html
# https://github.com/CCOSTAN/Home-AssistantConfig/blob/master/config/packages/lightning.yaml
#
alias: "Safety: Lightning notification"
id: 6e054688-5e75-48bd-9411-52a3e26264d1
mode: single

trigger:
  - platform: state
    entity_id: sensor.blitzortung_lightning_counter

condition:
  - condition: state
    entity_id: group.family
    state: 'home'
  - condition: numeric_state
    entity_id: sensor.blitzortung_lightning_counter
    above: 0
  - condition: state
    entity_id: input_boolean.snooze_lightning
    state: 'off'

action:
  - service: notify.robert
    data:
      message: "Er is bliksem waargenomen binnen {{ states('sensor.blitzortung_lightning_distance') }} km vanaf ons huis. Wees voorzichtig buitenshuis."
      data:
        title: 'Bliksemwaarschuwing!'
        actions:
          - action: "SNOOZE_LIGHTNING"
            title: "Stilhouden tot morgen"
          - action: "MAP"
            title: "Toon kaart"
            url: "/map"

  # - delay:
  #     minutes: 60

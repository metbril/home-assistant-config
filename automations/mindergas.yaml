---
# Post gas consumption to Mindergas.nl
#
# Dependencies:
# - sensor.gas_consumption
# - sensor.yesterday
#

alias: Post Gas Consumption to MinderGas.nl
description: >
  Post gas consumption to mindergas.nl daily at 00:15.

  The gas meter reading is updated once every hour,
  within 10 minutes after the full hour.
  Posting as soon as possible after that, with a safe margin.

id: 00dff5ad-9600-4932-b4de-17eae6928528
mode: single

trigger:
  - platform: time
    at: '00:15:00'

condition:
  - condition: numeric_state
    entity_id: sensor.gas_consumption
    above: "0"
  - condition: not
    conditions:
      - condition: state
        entity_id: sensor.yesterday
        state: unavailable

action:
  - alias: Post reading to mindergas.nl
    service: script.mindergas
    data:
      # date: "{{ states('sensor.date') }}"
      date: "{{ states('sensor.yesterday') }}"
      reading: "{{ states('sensor.gas_consumption') }}"

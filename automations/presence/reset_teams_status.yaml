---
alias: Teams Status Reset
description: >
  Reset Teams Status when not changed for a long time outside
  work hours.

  This usually happens when you put your laptop in sleep or
  hibernate mode without closing the Teams application first.

id: aaff7435-8f79-4657-af57-454710cde9b9
mode: single

trigger:
  # Teams status has not changed for more than 2 hours
  platform: template
  value_template: >
    {{ as_timestamp(now()) -
       as_timestamp(states.input_text.teams_status_robert.last_changed) >
       2*3600 }}

condition:
  # not a workday or after 18:00 ?
  - condition: or
    conditions:
      - condition: state
        entity_id: binary_sensor.workday
        state: "off"
      - condition: time
        after: "18:00:00"

action:
  - service: input_text.set_value
    data:
      entity_id: input_text.teams_status_robert
      value: unknown  # Don't use Offline to differentiate
  - service: notify.robert
    data:
      message: Microsoft Teams status forced to 'Unknown'
